Extract company data from the provided JSON document following these strict guidelines:

Show me your reasoning in numbered steps (how you decided what to extract, how you handled missing fields, etc.).
Then output the final JSON.

# Extraction Requirements
1. Document Processing:
   - Input is a JSON with document_number, document_type, category, text, and path
   - Documents may be in Spanish, Portuguese, or English
   - Preserve original language terms in company names, addresses, and relationship types
   - Count the total number of pages in the document (do not extract this from document text)

2. Data Normalization:
   - Convert all dates to YYYY-MM-DD format including companyDuration when a specific date is provided
   - Format addresses as "[Primary Address] - [Type] de [Name]" (e.g., "Calle Siempre Viva 123 - Municipio de San Isidro")
   - Handle anonymized data by extracting firstName, lastName, and identificationNumber with asterisks
   - Extract company size from "Tamaño de la empresa" section
   - Look for companyDuration in sections titled: "Vigencia", "Término de Duración", "Certifica - Vigencia", "Duración de la Sociedad", or "Plazo de Constitución"

3. Related Party Handling:
   - List each occurrence separately with complete information
   - Preserve exact relationshipType terminology from document
   - Include all occurrences when a person appears multiple times
   - For anonymized entries (e.g., "ACEPTACION SIN**********"), split name components and preserve asterisks in identificationNumber

4. Validation:
   - Verify against CERL schema.json
   - Ensure all required fields are present
   - Confirm all dates including companyDuration are properly formatted as YYYY-MM-DD
   - Check taxId follows the pattern ^[0-9.\-]+$$

# Required Output
```json
{
  "path": "$pdf_path",
  "result": {
    "companyName": "",
    "companyType": "",
    "country": "",
    "document_pages": 0,
    "documentType": "",
    "taxId": "",
    "mainAddress": "",
    "incorporationDate": "",
    "companyDuration": "",
    "registrationNumber": "",
    "size": "",
    "relatedParties": [
      {
        "firstName": "",
        "lastName": "",
        "identificationType": "",
        "identificationNumber": "",
        "relationshipType": ""
      }
    ],
    "embargoes": "",
    "liquidations": "",
    "documentIssueDate": "",
    "lastRegistrationRenewalDate": ""
  },
  "document_type": "$document_type",
  "document_number": "$document_number",
  "category": "$category"
}
```

Think step-by-step to ensure accurate extraction and proper JSON formatting:
1. Generating the JSON Output
2. Defining Data Mapping
3. Defining the Data Extraction
4. Refining Data Extraction
5. Extracting and Mapping Data
6. Extracting Related Parties
7. Extracting & Refining the Data
8. Refining Data Accuracy
9. Extracting and Finalizing Data
10. Constructing the Final JSON

Return the data collected in the required JSON format.
